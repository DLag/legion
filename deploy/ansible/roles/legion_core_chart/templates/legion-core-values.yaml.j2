rootDomain: {{ base_domain }}
rbac: true
dockerHubGroup: "{{ docker_repo }}"
pypiServer: "{{ pypi_repo }}"
version: "{{ legion_version }}"


{% if dex.enabled == true %}
auth:
  enabled: true
  annotations:
    nginx.ingress.kubernetes.io/configuration-snippet: |
        set_escape_uri $escaped_request_uri $request_uri;
    nginx.ingress.kubernetes.io/auth-signin: https://auth.{{ cluster_name }}/oauth2/start?rd=https://$host$escaped_request_uri
    nginx.ingress.kubernetes.io/auth-url: http://oauth2-proxy.kube-system.svc.cluster.local:4180/oauth2/auth
{% endif %}


grafana:
  adminUser: "{{ grafana.admin.username }}"
  adminPassword: "{{ grafana.admin.password }}"
  ingress:
    hosts:
      - "grafana.{{ base_domain }}"
    tls:
      - secretName: "{{ base_domain }}-tls"
        hosts: ["grafana.{{ base_domain }}"]
    annotations:
      nginx.ingress.kubernetes.io/configuration-snippet: |
          set_escape_uri $escaped_request_uri $request_uri;
      nginx.ingress.kubernetes.io/auth-signin: https://auth.{{ cluster_name }}/oauth2/start?rd=https://$host$escaped_request_uri
      nginx.ingress.kubernetes.io/auth-url: http://oauth2-proxy.kube-system.svc.cluster.local:4180/oauth2/auth
  setup:
    image:
      repository: "{{ docker_repo }}/k8s-ansible"
      tag: "{{ legion_version }}"

connections:
  docker:
    type: proxy
    url: "{{ model_docker_url }}"
    user: "{{ docker.user }}"
    password: "{{ docker.password }}"
